import{q as z,r as l,j as e,a as G,J as w,f as H}from"./app-Bs2T8Cel.js";import{A as K}from"./AdminLayout-fV7w1xsl.js";import{T as U}from"./Toast-D4UZEFGK.js";import{C as h}from"./circle-x-BVBFCtNM.js";import{C as k}from"./circle-check-big-CyiEMgwB.js";import{L as _}from"./loader-circle-D8wUzWpm.js";import{A as O}from"./arrow-left-BjysdjvJ.js";import{D as g,F as X}from"./file-text-CUkhy-jw.js";import{C as P}from"./clock-CEO_fwKu.js";import{c as Q}from"./createLucideIcon-CvzI4D8G.js";import{E as W}from"./external-link-BCkRiBIu.js";import{C as $}from"./circle-alert-Cj8kEujd.js";import{T as Y}from"./triangle-alert-DF30lgZj.js";import"./eye-off-DnHwywYB.js";import"./eye-CjirJiX5.js";import"./log-out-COQjk9kz.js";import"./x-C6So-ddW.js";import"./chevron-down-DXA6EQOq.js";import"./chevron-right-CQJsjOc3.js";import"./key-round-CJY62-0e.js";import"./users-BnbK67uW.js";import"./image-DW5R3q18.js";import"./star-CUSJV_Pf.js";import"./building-BTeyIkLo.js";import"./credit-card-C7X7qjcX.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],ee=Q("message-square",Z),Pe=()=>{const{order:a,payments:j,toast:x}=z().props,[E,n]=l.useState(!!x),[C,c]=l.useState(x||{type:"",message:""}),[S,A]=l.useState(null),[u,B]=l.useState({}),[T,d]=l.useState(null),[t,D]=l.useState(null),[i,b]=l.useState("verified"),[m,p]=l.useState(""),[f,N]=l.useState(!1);l.useEffect(()=>{if(x){n(!0);const s=setTimeout(()=>{n(!1)},5e3);return()=>clearTimeout(s)}},[x]);const M=async s=>{if(!(s.status!=="pending"||s.payment_method!=="virtual_account")){B(r=>({...r,[s.id]:!0}));try{const v=await(await fetch(`/api/v1/payments/${s.id}/check-status`)).json();v.status==="verified"?(c({type:"success",message:"Pembayaran telah diverifikasi!"}),n(!0),window.location.reload()):v.status==="rejected"&&(c({type:"error",message:"Pembayaran ditolak: "+v.message}),n(!0),window.location.reload())}catch(r){console.error("Error checking payment status:",r),c({type:"error",message:"Gagal memeriksa status pembayaran."}),n(!0)}finally{B(r=>({...r,[s.id]:!1}))}}},F=s=>{D(s),b("verified"),p("")},y=()=>{D(null),b("verified"),p("")},I=s=>{b(s)},R=()=>{if(!t)return;N(!0);const s={status:i,note:i==="rejected"?m:""};H.patch(route("admin.payments.verify",t.id),s,{onSuccess:()=>{N(!1),y(),A(null),c({type:"success",message:i==="verified"?"Pembayaran berhasil diverifikasi!":"Pembayaran berhasil ditolak!"}),n(!0),window.location.reload()},onError:()=>{N(!1),c({type:"error",message:"Gagal memproses pembayaran. Silakan coba lagi."}),n(!0)}})},J=s=>{switch(s){case"verified":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"rejected":return"bg-red-100 text-red-800";case"expired":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},L=s=>{switch(s){case"verified":return"Terverifikasi";case"pending":return"Menunggu Verifikasi";case"rejected":return"Ditolak";case"expired":return"Kadaluarsa";default:return s}},V=s=>{switch(s){case"verified":return e.jsx(k,{className:"h-5 w-5 text-green-600"});case"pending":return e.jsx(P,{className:"h-5 w-5 text-yellow-600"});case"rejected":return e.jsx(h,{className:"h-5 w-5 text-red-600"});case"expired":return e.jsx(Y,{className:"h-5 w-5 text-gray-600"});default:return e.jsx($,{className:"h-5 w-5 text-gray-600"})}},o=s=>{if(!s)return"-";const r=new Date(s);return new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)},q=s=>s?{BCA:"Bank Central Asia",BNI:"Bank Negara Indonesia",BRI:"Bank Rakyat Indonesia",MANDIRI:"Bank Mandiri",PERMATA:"Bank Permata",CIMB:"CIMB Niaga"}[s.toUpperCase()]||s:"";return e.jsxs(K,{activeMenu:"order-management",children:[e.jsx(G,{title:`Payment History: ${a.order_number}`}),E&&e.jsx(U,{type:C.type,message:C.message,onClose:()=>n(!1)}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",onClick:()=>d(null),children:e.jsxs("div",{className:"bg-white p-2 rounded-lg max-w-3xl max-h-[90vh] w-full",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"flex justify-end mb-2",children:e.jsx("button",{onClick:()=>d(null),className:"p-1 bg-gray-200 rounded-full",children:e.jsx(h,{className:"w-5 h-5 text-gray-700"})})}),e.jsx("div",{className:"overflow-auto max-h-[80vh]",children:e.jsx("img",{src:T,alt:"Payment Proof",className:"mx-auto max-w-full object-contain"})})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Verifikasi Pembayaran"}),e.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:e.jsx(h,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Order Number"}),e.jsx("p",{className:"font-medium",children:t.order_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Jumlah"}),e.jsx("p",{className:"font-medium text-green-600",children:t.formatted_amount})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Metode Pembayaran"}),e.jsx("p",{className:"font-medium",children:t.payment_method_display})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Tanggal"}),e.jsx("p",{className:"font-medium",children:o(t.created_at)})]})]})}),t.payment_proof&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-md font-medium mb-2",children:"Bukti Pembayaran"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg flex justify-center",children:e.jsx("img",{src:t.payment_proof_url,alt:"Bukti Pembayaran",className:"max-h-48 object-contain cursor-pointer",onClick:()=>d(t.payment_proof_url)})}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("button",{onClick:()=>d(t.payment_proof_url),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Lihat Gambar Lengkap"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status Pembayaran"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>I("verified"),className:`py-2 px-4 rounded-lg border flex items-center justify-center ${i==="verified"?"bg-green-600 text-white border-green-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Verifikasi"]}),e.jsxs("button",{type:"button",onClick:()=>I("rejected"),className:`py-2 px-4 rounded-lg border flex items-center justify-center ${i==="rejected"?"bg-red-600 text-white border-red-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Tolak"]})]})]}),i==="rejected"&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Alasan Penolakan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:m,onChange:s=>p(s.target.value),className:"w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Jelaskan alasan penolakan pembayaran ini",rows:"3",required:!0}),i==="rejected"&&!m&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:"Alasan penolakan wajib diisi"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:y,className:"py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"button",onClick:R,disabled:f||i==="rejected"&&!m,className:`py-2 px-4 rounded-lg text-white ${i==="verified"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"} ${f||i==="rejected"&&!m?"opacity-70 cursor-not-allowed":""}`,children:f?e.jsxs("span",{className:"flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin"}),"Memproses..."]}):i==="verified"?"Verifikasi Pembayaran":"Tolak Pembayaran"})]})]})}),e.jsxs("div",{className:"py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(w,{href:route("admin.orders.show",a.id),className:"inline-flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"Kembali ke Detail Pesanan"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-500 p-6 text-white",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Riwayat Pembayaran"}),e.jsxs("p",{className:"text-white/80",children:["Order #",a.order_number," (",a.clientName,")"]})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 sm:text-right",children:[e.jsx("p",{className:"text-white/80",children:"Total Dibayar"}),e.jsx("p",{className:"text-2xl font-bold",children:a.paidAmount}),e.jsxs("p",{className:"text-white/80",children:["dari ",a.price," (",a.paymentPercentage,"%)"]})]})]})}),e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-purple-600 h-3 rounded-full",style:{width:`${a.paymentPercentage}%`}})}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mt-1",children:[e.jsx("span",{children:"Rp 0"}),e.jsxs("span",{children:[a.paymentPercentage,"%"]}),e.jsx("span",{children:a.price})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Daftar Pembayaran"}),e.jsxs(w,{href:route("admin.payments.detail",a.id),className:"inline-flex items-center px-4 py-2 bg-purple-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-purple-700 focus:outline-none",children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Tambah Pembayaran"]})]}),j&&j.length>0?e.jsx("div",{className:"space-y-4",children:j.map(s=>e.jsxs("div",{className:`border ${s.status==="rejected"?"border-red-200":"border-gray-200"} rounded-lg overflow-hidden`,children:[e.jsxs("div",{className:`p-4 flex justify-between items-center cursor-pointer hover:bg-gray-50 ${s.status==="rejected"?"bg-red-50":""}`,onClick:()=>A(S===s.id?null:s.id),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-full mr-3 ${s.status==="verified"?"bg-green-100":s.status==="pending"?"bg-yellow-100":s.status==="rejected"?"bg-red-100":"bg-gray-100"}`,children:V(s.status)}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.formatted_amount}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${J(s.status)}`,children:L(s.status)})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.payment_type_display," - ",s.payment_method_display,s.payment_method==="virtual_account"&&s.bank_code&&e.jsxs("span",{className:"ml-1 font-medium",children:["(",s.bank_code,")"]})]}),s.payment_method==="virtual_account"&&s.va_number&&s.status==="pending"&&e.jsxs("p",{className:"text-xs text-blue-600 font-medium mt-1",children:["VA: ",s.va_number]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-sm text-gray-500 mr-3",children:o(s.created_at)}),s.status==="pending"&&s.payment_method==="virtual_account"&&e.jsx("button",{onClick:r=>{r.stopPropagation(),M(s)},disabled:u[s.id],className:"inline-flex items-center px-3 py-1 bg-blue-600 text-white text-xs rounded-md hover:bg-blue-700 disabled:bg-blue-300",children:u[s.id]?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-3 w-3 mr-1 animate-spin"}),"Memeriksa..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Cek Status"]})})]})]}),s.status==="rejected"&&s.note&&e.jsxs("div",{className:"px-4 py-3 bg-red-50 border-t border-red-200 flex items-start",children:[e.jsx(ee,{className:"h-5 w-5 text-red-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Alasan Penolakan:"}),e.jsx("p",{className:"text-sm text-red-700",children:s.note})]})]}),S===s.id&&e.jsx("div",{className:"p-4 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Detail Pembayaran"}),e.jsx("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"ID Pembayaran"}),e.jsx("p",{className:"font-medium",children:s.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Tanggal Dibuat"}),e.jsx("p",{className:"font-medium",children:o(s.created_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Jenis Pembayaran"}),e.jsx("p",{className:"font-medium",children:s.payment_type_display})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Metode Pembayaran"}),e.jsx("p",{className:"font-medium",children:s.payment_method_display})]}),s.bank_code&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Bank"}),e.jsx("p",{className:"font-medium",children:s.bank_code})]}),s.transaction_id&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Transaction ID"}),e.jsx("p",{className:"font-medium truncate",children:s.transaction_id})]}),s.va_number&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-gray-500",children:"Virtual Account"}),e.jsxs("p",{className:"font-medium",children:[q(s.bank_code)," - ",s.va_number]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Silakan lakukan pembayaran sesuai dengan nomor VA di atas"})]}),s.expiry_time&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-gray-500",children:"Kadaluarsa Pada"}),e.jsx("p",{className:"font-medium",children:o(s.expiry_time)})]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Status"}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:`p-2 rounded-full mr-2 ${s.status==="verified"?"bg-green-100":s.status==="pending"?"bg-yellow-100":s.status==="rejected"?"bg-red-100":"bg-gray-100"}`,children:V(s.status)}),e.jsx("span",{className:"font-medium",children:L(s.status)})]}),s.status==="verified"&&e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["Diverifikasi pada: ",o(s.verified_at)]}),s.verified_by&&e.jsxs("p",{children:["Diverifikasi oleh: ",s.verified_by_name]})]}),s.status==="rejected"&&s.note&&e.jsxs("div",{className:"mt-2 p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("p",{className:"font-medium text-red-800 text-sm",children:"Alasan Penolakan:"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:s.note})]}),s.status==="pending"&&s.payment_method==="bank_transfer"&&e.jsx("div",{className:"mt-2",children:e.jsxs("button",{onClick:r=>{r.stopPropagation(),F(s)},className:"inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700",children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"Verifikasi Pembayaran"]})}),s.status==="pending"&&s.payment_method==="virtual_account"&&e.jsxs("div",{className:"mt-2 space-y-2",children:[e.jsx("button",{onClick:()=>M(s),disabled:u[s.id],className:"inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 disabled:bg-blue-300 w-full justify-center",children:u[s.id]?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-1 animate-spin"}),"Memeriksa Status..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Cek Status Pembayaran"]})}),e.jsx("div",{className:"text-sm text-gray-500 italic",children:"Pembayaran virtual account akan otomatis diverifikasi oleh sistem."})]})]})]}),s.payment_method==="bank_transfer"&&s.payment_proof&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 mb-2",children:"Bukti Pembayaran"}),e.jsxs("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s.payment_proof_url,alt:"Bukti Pembayaran",className:"max-h-64 rounded-lg object-contain cursor-pointer",onClick:()=>d(s.payment_proof_url)})}),e.jsx("div",{className:"flex justify-center mt-3",children:e.jsxs("button",{onClick:()=>d(s.payment_proof_url),className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Lihat Gambar Lengkap"]})})]})]})]})})]},s.id))}):e.jsxs("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Belum Ada Pembayaran"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Belum ada catatan pembayaran untuk pesanan ini."}),e.jsxs(w,{href:route("admin.payments.detail",a.id),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors inline-flex items-center",children:[e.jsx(g,{className:"h-4 w-4 mr-1"}),"Proses Pembayaran"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-8",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(g,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Total Dibayar"}),e.jsx("p",{className:"font-medium",children:a.paidAmount})]})]})}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(g,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Sisa Pembayaran"}),e.jsx("p",{className:"font-medium",children:a.remainingAmount})]})]})}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(X,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Status Pembayaran"}),e.jsx("p",{className:"font-medium",children:a.isFullyPaid?"Lunas":"Belum Lunas"})]})]})})]})]})]})]})]})};export{Pe as default};
