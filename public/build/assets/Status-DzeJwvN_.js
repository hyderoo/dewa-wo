import{r as n,j as e,a as J,J as h}from"./app-Bs2T8Cel.js";import{B as H}from"./BaseLayout-B_SKP1-R.js";import{C as f}from"./circle-check-big-CyiEMgwB.js";import{C as g}from"./circle-x-BVBFCtNM.js";import{C as N}from"./circle-alert-Cj8kEujd.js";import{A as K}from"./arrow-left-BjysdjvJ.js";import{B as V}from"./building-BTeyIkLo.js";import{C as z}from"./credit-card-C7X7qjcX.js";import{C as G}from"./copy-Cj-b3sGt.js";import{L as O}from"./loader-circle-D8wUzWpm.js";import{R as U}from"./refresh-cw-HeUvamWv.js";import{C as W}from"./clock-CEO_fwKu.js";import"./createLucideIcon-CvzI4D8G.js";const X="font-cormorant font-semibold",me=({payment:t,auth:k})=>{const[u,p]=n.useState(!1),[i,v]=n.useState(t.status),[_,S]=n.useState(new Date),[C,b]=n.useState(!1),[T,P]=n.useState(y()),[x,c]=n.useState(!1),[l,m]=n.useState({type:"",message:""}),[d,D]=n.useState([]);n.useEffect(()=>{if(t.payment_data)try{const a=JSON.parse(t.payment_data);a.payment_instructions&&Array.isArray(a.payment_instructions)&&D(a.payment_instructions)}catch(a){console.error("Error parsing payment data:",a)}},[t.payment_data]);function y(){if(!t.expiry_time)return 0;const s=new Date(t.expiry_time)-new Date;return s>0?Math.floor(s/1e3):0}n.useEffect(()=>{t.payment_method==="virtual_account"&&t.status==="pending"&&j()},[]),n.useEffect(()=>{if(t.status==="pending"){const a=setInterval(()=>{P(y())},1e3);return()=>clearInterval(a)}},[]),n.useEffect(()=>{if(x){const a=setTimeout(()=>{c(!1)},5e3);return()=>clearTimeout(a)}},[x]);const j=async(a=!1)=>{if(!u){p(!0);try{const s=await(await fetch(`/api/v1/payments/${t.id}/check-status`)).json();console.log(s),s.status!=="error"?s.status!==i?s.status==="verified"?(m({type:"success",message:"Pembayaran berhasil diverifikasi! Halaman akan dimuat ulang."}),c(!0),setTimeout(()=>{window.location.reload()},2e3)):s.status==="rejected"?(m({type:"error",message:"Pembayaran ditolak! Halaman akan dimuat ulang."}),c(!0),setTimeout(()=>{window.location.reload()},2e3)):s.status==="expired"?(m({type:"warning",message:"Pembayaran telah kedaluwarsa! Halaman akan dimuat ulang."}),c(!0),setTimeout(()=>{window.location.reload()},2e3)):(v(s.status),m({type:"info",message:`Status pembayaran berubah menjadi: ${w(s.status)}`}),c(!0)):a||(m({type:"info",message:`Status pembayaran masih ${w(i)}`}),c(!0)):a||(m({type:"error",message:s.message||"Gagal memeriksa status pembayaran"}),c(!0)),S(new Date)}catch(r){console.error("Error checking payment status:",r),a||(m({type:"error",message:"Terjadi kesalahan saat memeriksa status pembayaran"}),c(!0))}finally{p(!1)}}},A=a=>{navigator.clipboard.writeText(a),b(!0),setTimeout(()=>b(!1),2e3)},M=a=>{if(a<=0)return"00:00:00";const r=Math.floor(a/3600),s=Math.floor(a%3600/60),R=a%60;return`${String(r).padStart(2,"0")}:${String(s).padStart(2,"0")}:${String(R).padStart(2,"0")}`},L=()=>{switch(i){case"verified":return e.jsx("div",{className:"w-20 h-20 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(f,{className:"h-12 w-12 text-green-500"})});case"pending":return e.jsx("div",{className:"w-20 h-20 mx-auto bg-yellow-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(W,{className:"h-12 w-12 text-yellow-500"})});case"rejected":case"expired":return e.jsx("div",{className:"w-20 h-20 mx-auto bg-red-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(g,{className:"h-12 w-12 text-red-500"})});default:return e.jsx("div",{className:"w-20 h-20 mx-auto bg-gray-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(N,{className:"h-12 w-12 text-gray-500"})})}},B=()=>{switch(i){case"verified":return"Pembayaran Berhasil";case"pending":return"Menunggu Pembayaran";case"rejected":return"Pembayaran Ditolak";case"expired":return"Pembayaran Kadaluarsa";default:return"Status Pembayaran"}},w=a=>{switch(a){case"verified":return"Terverifikasi";case"pending":return"Menunggu Verifikasi";case"rejected":return"Ditolak";case"expired":return"Kadaluarsa";default:return a}},I=()=>{switch(i){case"verified":return"Pembayaran Anda telah berhasil diverifikasi. Terima kasih atas pembayaran Anda.";case"pending":return"Kami sedang menunggu konfirmasi pembayaran Anda. Harap selesaikan pembayaran sesuai instruksi.";case"rejected":return"Maaf, pembayaran Anda ditolak. Silakan coba metode pembayaran lain.";case"expired":return"Maaf, batas waktu pembayaran telah berakhir. Silakan lakukan pembayaran baru.";default:return"Silakan periksa status pembayaran Anda."}},$=a=>a?d.length>0?{name:`${a} Virtual Account`,instructions:d.map(r=>r.instruction)}:{name:"",instructions:[]}:{name:"",instructions:[]},F=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a),E=a=>{if(!a)return"-";const r=new Date(a);return new Intl.DateTimeFormat("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)},o=t.payment_method==="virtual_account"?$(t.bank_code):null;return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Status Pembayaran"}),e.jsx(H,{auth:k,children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[x&&e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-md rounded-lg shadow-lg p-4 ${l.type==="success"?"bg-green-100 border border-green-200":l.type==="error"?"bg-red-100 border border-red-200":l.type==="warning"?"bg-yellow-100 border border-yellow-200":"bg-blue-100 border border-blue-200"}`,children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:l.type==="success"?e.jsx(f,{className:"h-5 w-5 text-green-500"}):l.type==="error"?e.jsx(g,{className:"h-5 w-5 text-red-500"}):l.type==="warning"?e.jsx(AlertTriangle,{className:"h-5 w-5 text-yellow-500"}):e.jsx(N,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:`text-sm font-medium ${l.type==="success"?"text-green-800":l.type==="error"?"text-red-800":l.type==="warning"?"text-yellow-800":"text-blue-800"}`,children:l.message})}),e.jsx("div",{className:"ml-auto pl-3",children:e.jsx("div",{className:"-mx-1.5 -my-1.5",children:e.jsx("button",{onClick:()=>c(!1),className:"inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:e.jsx(g,{className:"h-5 w-5 text-gray-500"})})})})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs(h,{href:route("payment.history",t.order_id),className:"inline-flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Kembali ke Riwayat Pembayaran"]})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-xl",children:e.jsxs("div",{className:"p-8 text-center",children:[L(),e.jsx("h2",{className:`${X} text-2xl font-bold text-gray-900 mb-2`,children:B()}),e.jsx("p",{className:"text-gray-600 mb-6",children:I()}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6 max-w-md mx-auto",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-left",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Nomor Pesanan"}),e.jsx("p",{className:"font-medium",children:t.order.order_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jumlah"}),e.jsx("p",{className:"font-medium text-indigo-600",children:t.formatted_amount||F(t.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jenis Pembayaran"}),e.jsx("p",{className:"font-medium",children:t.payment_type==="down_payment"?"Uang Muka":t.payment_type==="installment"?"Cicilan":"Pelunasan"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Metode Pembayaran"}),e.jsx("p",{className:"font-medium flex items-center",children:t.payment_method==="bank_transfer"?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-4 w-4 mr-1 text-gray-500"}),"Transfer Bank"]}):t.payment_method==="virtual_account"?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-1 text-blue-500"}),"Virtual Account"]}):t.payment_method})]}),t.bank_code&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Bank"}),e.jsx("p",{className:"font-medium",children:o?o.name:t.bank_code})]}),i==="pending"&&t.expiry_time&&e.jsxs("div",{className:"col-span-2 mt-2 p-2 bg-yellow-50 rounded-lg border border-yellow-100",children:[e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:"Batas Waktu:"}),e.jsx("p",{className:"text-lg font-bold text-yellow-600",children:M(T)}),e.jsxs("p",{className:"text-xs text-gray-600",children:["(",E(t.expiry_time),")"]})]}),t.payment_method==="virtual_account"&&t.va_number&&e.jsxs("div",{className:"col-span-2 mt-2 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx("p",{className:"text-sm text-gray-700 font-medium",children:"Nomor Virtual Account:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"text-lg font-bold text-blue-700 font-mono mr-2",children:t.va_number}),e.jsx("button",{onClick:()=>A(t.va_number),className:"p-1.5 bg-gray-100 rounded-md hover:bg-gray-200 transition",children:C?e.jsx(f,{className:"h-4 w-4 text-green-600"}):e.jsx(G,{className:"h-4 w-4 text-gray-600"})})]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Lakukan pembayaran melalui ",(o==null?void 0:o.name)||t.bank_code," Mobile/Internet Banking atau ATM"]})]})]})}),i==="pending"&&t.payment_method==="virtual_account"&&t.va_number&&e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 mb-6 max-w-md mx-auto text-left",children:[e.jsxs("h3",{className:"font-medium text-blue-700 mb-2",children:["Cara Pembayaran ",o.name,":"]}),d.length>0?e.jsx("ol",{className:"list-decimal list-inside space-y-3 text-blue-700",children:d.map((a,r)=>e.jsx("li",{className:"text-sm",children:a.instruction},r))}):e.jsx("ol",{className:"list-decimal list-inside space-y-1 text-blue-700",children:o.instructions.map((a,r)=>e.jsx("li",{className:"text-sm",children:a},r))})]}),i==="pending"&&t.payment_method==="virtual_account"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>j(!1),disabled:u,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-300",children:u?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),"Memeriksa..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Periksa Status Pembayaran"]})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Terakhir diperiksa: ",_.toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[e.jsx(h,{href:route("payment.history",t.order_id),className:"inline-flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Lihat Riwayat Pembayaran"}),(i==="rejected"||i==="expired")&&e.jsx(h,{href:route("payment.detail",t.order_id),className:"inline-flex items-center justify-center px-4 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700",children:"Lakukan Pembayaran Baru"})]})]})})]})})})]})};export{me as default};
