import{q as Q,r as o,S as W,j as e,f as Y}from"./app-Bs2T8Cel.js";import{T as Z}from"./Toast-D4UZEFGK.js";import ee from"./DeleteVirtualAccountConfirmationModal-C8dXf7UX.js";import{C as O}from"./credit-card-C7X7qjcX.js";import{X as U}from"./x-C6So-ddW.js";import{U as se}from"./upload-1Eayvxwr.js";import{P as te}from"./plus-BORCrL2h.js";import{T as ne}from"./trash-BqU_uCmy.js";import{S as re}from"./save-CKqFpiyj.js";import"./trash-2-B32JthJw.js";import"./createLucideIcon-CvzI4D8G.js";import"./circle-alert-Cj8kEujd.js";const be=()=>{const{virtualAccounts:N,toast:x}=Q().props,k=o.useRef(null),[F,f]=o.useState(!1),[p,$]=o.useState(null),[B,g]=o.useState(!1),[C,v]=o.useState({type:"",message:""}),[S,b]=o.useState(null),[A,j]=o.useState(!1),[z,T]=o.useState(!1),[R,M]=o.useState(null),[i,m]=o.useState([{step:"",instruction:""}]),{data:r,setData:c,post:D,processing:I,errors:a,reset:P,clearErrors:V,setError:h}=W({bank_code:"",name:"",account_number:"",description:"",logo:null,_logo:"",is_active:!0,payment_instructions:[],_method:"PUT"});o.useEffect(()=>{if(x){v({type:x.type,message:x.message}),x.type==="success"&&(f(!1),P(),b(null),m([{step:"",instruction:""}])),j(!1),g(!0);const s=setTimeout(()=>{g(!1)},5e3);return()=>clearTimeout(s)}},[x]);const u=s=>{const{name:t,value:n,type:l,checked:d,files:w}=s.target;if(l==="file"){if(w&&w.length>0){const y=w[0];if(!["image/jpeg","image/png","image/gif","image/jpg"].includes(y.type)){h("logo","Please select a valid image file (JPEG, PNG, GIF)");return}if(y.size>2*1024*1024){h("logo","Image size should be less than 2MB");return}V("logo"),c("logo",y);const K=URL.createObjectURL(y);b(K)}}else l==="checkbox"?c(t,d):c(t,n)},E=(s,t,n)=>{const l=[...i];l[s][t]=n,m(l),c("payment_instructions",l)},G=()=>{m([...i,{step:"",instruction:""}])},L=s=>{const t=i.filter((n,l)=>l!==s);m(t),c("payment_instructions",t)},_=(s=null)=>{$(s),V(),s?(c({bank_code:s.bank_code,name:s.name,account_number:s.account_number||"",description:s.description||"",logo:null,_logo:s.logo||"/va-placeholder.jpg",is_active:s.is_active||!0,payment_instructions:s.payment_instructions||[],_method:"PUT"}),s.payment_instructions&&s.payment_instructions.length>0?m(s.payment_instructions):m([{step:"",instruction:""}]),b(s.logo)):(P(),c({bank_code:"",name:"",account_number:"",description:"",logo:null,_logo:"",is_active:!0,payment_instructions:[],_method:""}),b(null),m([{step:"",instruction:""}])),f(!0)},q=s=>{s.preventDefault();let t=!1;if(r.bank_code.trim()||(h("bank_code","Bank code is required"),t=!0),r.name.trim()||(h("name","Virtual Account name is required"),t=!0),i.some(d=>!d.step.trim()||!d.instruction.trim())&&(h("payment_instructions","All payment instructions must have both step and instruction filled"),t=!0),t)return;c("payment_instructions",i);const n=new FormData;n.append("bank_code",r.bank_code),n.append("name",r.name),n.append("account_number",r.account_number||""),n.append("description",r.description||""),n.append("is_active",r.is_active?"1":"0"),n.append("payment_instructions",JSON.stringify(i)),r.logo instanceof File&&(console.log("Appending logo file to form data:",r.logo.name),n.append("logo",r.logo)),p&&n.append("_method","PUT"),j(!0);const l={preserveState:!1,preserveScroll:!0,forceFormData:!0,onSuccess:()=>{j(!1)},onError:d=>{j(!1),console.error("Form submission errors:",d),d.logo&&(v({type:"error",message:d.logo}),g(!0))}};D(p?route("admin.virtual-accounts.update",p.id):route("admin.virtual-accounts.store"),n,l)},J=s=>{M(s),T(!0)},X=()=>{T(!1),M(null)},H=s=>{Y.patch(route("admin.virtual-accounts.toggle-active",s.id),{},{preserveScroll:!0,onError:()=>{v({type:"error",message:"Failed to toggle virtual account status"}),g(!0)}})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8 text-gray-600",children:[B&&e.jsx(Z,{type:C.type,message:C.message,onClose:()=>g(!1)}),e.jsx(ee,{isOpen:z,onClose:X,virtualAccount:R}),e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-indigo-600 p-6 md:p-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-semibold text-white text-center tracking-wide",children:"Virtual Account Management"}),e.jsx("p",{className:"text-center text-white/80 mt-2 max-w-2xl mx-auto",children:"Manage virtual accounts for Midtrans payment gateway"})]}),e.jsx("div",{className:"p-4 md:p-6 bg-gray-50 border-b border-gray-200",children:e.jsx("button",{onClick:()=>_(),className:"w-full md:w-auto bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2",children:"+ Add New Virtual Account"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6 md:p-8",children:N&&N.length>0?N.map(s=>{var t;return e.jsx("div",{className:`bg-white border ${s.is_active?"border-purple-500 ring-2 ring-purple-300":"border-gray-200"} rounded-xl shadow-md hover:shadow-lg transition-shadow overflow-hidden`,children:e.jsxs("div",{className:"p-6",children:[s.is_active&&e.jsx("div",{className:"mb-2",children:e.jsx("span",{className:"bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded",children:"Active"})}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:s.logo||"/va-placeholder.jpg",alt:s.name,className:`w-16 h-16 rounded-full object-cover mr-4 border-2 ${s.is_active?"border-purple-500":"border-gray-200"}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.bank_code})]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[s.account_number&&e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Account Number"}),e.jsx("p",{className:"font-medium",children:s.account_number})]})}),s.description&&e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Description"}),e.jsx("p",{className:"font-medium",children:s.description})]})}),e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Payment Instructions"}),e.jsxs("p",{className:"font-medium",children:[((t=s.payment_instructions)==null?void 0:t.length)||0," steps"]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-4",children:[e.jsx("button",{onClick:()=>H(s),className:`px-3 py-1 rounded-full text-sm ${s.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-100 text-gray-800 hover:bg-gray-200"}`,children:s.is_active?"Active":"Inactive"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>_(s),className:"text-blue-500 hover:text-blue-700 text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>J(s),className:"text-red-500 hover:text-red-700 text-sm",children:"Delete"})]})]})]})},s.id)}):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold text-gray-900",children:"No virtual accounts added"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by adding a new virtual account"}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>_(),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:"+ Add New Virtual Account"})})]})})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl z-10 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:p?"Edit Virtual Account":"Add New Virtual Account"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(U,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:e.jsxs("form",{id:"vaForm",onSubmit:q,encType:"multipart/form-data",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Bank Code ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"bank_code",value:r.bank_code,onChange:u,className:`w-full px-3 py-2 border ${a.bank_code?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500`,placeholder:"e.g., bca, bni, mandiri"}),a.bank_code&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.bank_code})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Virtual Account Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"name",value:r.name,onChange:u,className:`w-full px-3 py-2 border ${a.name?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500`,placeholder:"Enter name (e.g., BCA Virtual Account)"}),a.name&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.name})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Account Number ",e.jsx("span",{className:"text-gray-400 text-xs font-normal",children:"(Optional)"})]}),e.jsx("input",{type:"text",name:"account_number",value:r.account_number,onChange:u,className:`w-full px-3 py-2 border ${a.account_number?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500`,placeholder:"Virtual Account number (if fixed)"}),a.account_number&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.account_number})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center",children:[e.jsx("span",{children:"Bank Logo"}),e.jsx("span",{className:"ml-2 text-gray-400 text-xs font-normal",children:"(Optional)"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-24 h-24 border-2 border-dashed ${a.logo?"border-red-400 bg-red-50":"border-gray-300"} rounded-full flex items-center justify-center overflow-hidden`,children:S?e.jsx("img",{src:S,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx("div",{className:"text-center",children:e.jsx(O,{className:"w-8 h-8 text-gray-400 mx-auto"})})}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("input",{type:"file",name:"logo",id:"logo-upload",ref:k,accept:"image/jpeg,image/png,image/gif,image/jpg",onChange:u,className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>k.current.click(),className:"px-4 py-2 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500 inline-flex items-center",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Browse Logo"]}),r.logo instanceof File&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Selected: ",r.logo.name]})]})]}),a.logo&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.logo})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Description ",e.jsx("span",{className:"text-gray-400 text-xs font-normal",children:"(Optional)"})]}),e.jsx("textarea",{name:"description",value:r.description,onChange:u,className:`w-full px-3 py-2 border ${a.description?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500`,rows:"3",placeholder:"Optional description of this virtual account"}),a.description&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.description})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Payment Instructions ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("button",{type:"button",onClick:G,className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded text-purple-700 bg-purple-100 hover:bg-purple-200",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"Add Step"]})]}),a.payment_instructions&&e.jsx("div",{className:"text-red-500 text-sm mb-2",children:a.payment_instructions}),e.jsx("div",{className:"space-y-3 bg-gray-50 p-3 rounded-md",children:i.map((s,t)=>e.jsxs("div",{className:"flex space-x-2 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"mb-1",children:e.jsx("input",{type:"text",placeholder:"Step title (e.g., Open Mobile Banking)",value:s.step,onChange:n=>E(t,"step",n.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded"})}),e.jsx("div",{children:e.jsx("textarea",{placeholder:"Detailed instruction",value:s.instruction,onChange:n=>E(t,"instruction",n.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded",rows:"2"})})]}),i.length>1&&e.jsx("button",{type:"button",onClick:()=>L(t),className:"mt-1 p-1 text-red-500 hover:bg-red-100 rounded",children:e.jsx(ne,{className:"w-4 h-4"})})]},t))})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",name:"is_active",checked:r.is_active,onChange:u,className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 block text-sm text-gray-700",children:"Active"})]})]})}),e.jsx("div",{className:"p-6 border-t border-gray-200 sticky bottom-0 bg-white rounded-b-xl z-10",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:()=>f(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md inline-flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",form:"vaForm",disabled:I||A,className:"px-6 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-70 disabled:cursor-not-allowed inline-flex items-center",children:[e.jsx(re,{className:"w-4 h-4 mr-2"}),A?"Uploading...":I?"Processing...":p?"Update":"Add"]})]})})]})})]})};export{be as default};
