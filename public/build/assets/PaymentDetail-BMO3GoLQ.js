import{q as ee,r as n,S as ae,j as e,a as se}from"./app-Bj-2ttWe.js";import{A as te}from"./AdminLayout-C9KiesPq.js";import{T as ne}from"./Toast-0AKSzmFv.js";import{A as V}from"./arrow-left-CNY0Mjs2.js";import{T as re}from"./triangle-alert-BbqQ4372.js";import{B as $}from"./building-C3Qd_UEZ.js";import{C as A}from"./credit-card-UvNpbFda.js";import{D as ie}from"./file-text-BGbz3DAs.js";import{U as le}from"./upload-BYAEokgQ.js";import{C as me}from"./circle-alert-DbwOTSu0.js";import{C as de}from"./circle-check-big-3DSExcF6.js";import{L as oe}from"./loader-circle-1J1U9OfI.js";import"./createLucideIcon-Q6M-lg5u.js";import"./eye-off-eoUXuo7G.js";import"./eye-BR07TQjy.js";import"./log-out-DiVVTNjJ.js";import"./x-P4FUM78l.js";import"./chevron-down-BOcF8omZ.js";import"./chevron-right-CIgsXY0k.js";import"./key-round-BKENG61x.js";import"./users-Dpajf5mq.js";import"./image-B3SenHd_.js";import"./star-IVzQzElw.js";const De=()=>{const{order:s,banks:E,virtualAccounts:j,toast:b}=ee().props,[R,c]=n.useState(!!b),[P,g]=n.useState(b||{type:"",message:""}),[S,C]=n.useState(1),[i,F]=n.useState(null),[l,T]=n.useState(null),[x,B]=n.useState(null),[L,y]=n.useState(!1),[M,u]=n.useState(!1),[f,U]=n.useState(null),[q,I]=n.useState(""),[D,N]=n.useState(null),[J,k]=n.useState(""),{data:t,setData:m,post:v,processing:G,errors:d}=ae({payment_type:s.requires_down_payment?"down_payment":"full_payment",payment_method:"",bank_code:"",amount:s.requires_down_payment?s.down_payment_amount_value:s.remainingAmount,payment_proof:null});n.useEffect(()=>{(()=>{const r=new Date,o=new Date(r.getTime()+24*60*60*1e3);U(o)})()},[]),n.useEffect(()=>{const a=s.requires_down_payment?s.down_payment_amount_value:s.remainingAmount;k(w(a.toString()))},[s]),n.useEffect(()=>{if(!f)return;const a=()=>{const h=f-new Date;if(h<=0){I("Waktu pembayaran telah habis");return}const X=Math.floor(h/(1e3*60*60)),Y=Math.floor(h%(1e3*60*60)/(1e3*60)),Z=Math.floor(h%(1e3*60)/1e3);I(`${X.toString().padStart(2,"0")}:${Y.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`)};a();const r=setInterval(a,1e3);return()=>clearInterval(r)},[f]),n.useEffect(()=>{if(b){const a=setTimeout(()=>{c(!1)},5e3);return()=>clearTimeout(a)}},[b]);const _=a=>{F(a),m("payment_method",a),T(null),B(null),m("bank_code",""),C(2)},K=a=>{T(a),m("bank_code",a.code)},O=a=>{B(a),m("bank_code",a.bank_code)},W=a=>{const r=a.target.files[0];if(m("payment_proof",r),r){const o=new FileReader;o.onload=h=>{N(h.target.result)},o.readAsDataURL(r)}else N(null)},z=()=>{u(!0),y(!1),t.payment_method==="bank_transfer"?v(route("admin.payments.process",s.id),{onSuccess:()=>{u(!1),window.location.href=route("admin.payments.history",s.id)},onError:()=>{u(!1),g({type:"error",message:"Terjadi kesalahan saat memproses pembayaran. Silakan coba lagi."}),c(!0)}}):t.payment_method==="virtual_account"?v(route("admin.payments.midtrans",s.id),{onSuccess:a=>{u(!1),a.success?window.location.href=route("admin.payments.history",s.id):(g({type:"error",message:a.message||"Terjadi kesalahan saat memproses pembayaran."}),c(!0))},onError:()=>{u(!1),g({type:"error",message:"Terjadi kesalahan saat memproses pembayaran. Silakan coba lagi."}),c(!0)}}):t.payment_method==="cash"&&v(route("admin.payments.add-cash",s.id),{onSuccess:()=>{u(!1),window.location.href=route("admin.payments.history",s.id)},onError:()=>{u(!1),g({type:"error",message:"Terjadi kesalahan saat memproses pembayaran. Silakan coba lagi."}),c(!0)}})},w=a=>{if(!a)return"";const r=a.toString().replace(/\D/g,"");return r===""?"":new Intl.NumberFormat("id-ID").format(r)},H=a=>a&&parseInt(a.replace(/\D/g,""),10)||0,Q=a=>{const r=w(a.target.value);k(r);const o=H(r);o>s.remainingAmount?(k(w(s.remainingAmount.toString())),m("amount",s.remainingAmount),g({type:"warning",message:"Jumlah pembayaran tidak boleh melebihi sisa pembayaran."}),c(!0)):m("amount",o)},p=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a);return e.jsxs(te,{activeMenu:"order-management",children:[e.jsx(se,{title:`Process Payment: ${s.order_number}`}),R&&e.jsx(ne,{type:P.type,message:P.message,onClose:()=>c(!1)}),e.jsxs("div",{className:"py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("a",{href:route("admin.orders.show",s.id),className:"inline-flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Kembali ke Detail Pesanan"]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[e.jsx("div",{className:"bg-gradient-to-r from-pink-500 to-rose-500 p-6 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Proses Pembayaran"}),e.jsxs("p",{className:"text-white/80",children:["Order #",s.order_number," (",s.clientName,")"]})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 sm:text-right",children:[e.jsx("p",{className:"text-white/80",children:"Sisa Pembayaran"}),e.jsx("p",{className:"text-2xl font-bold",children:p(s.remainingAmount)})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-100 flex items-center",children:[e.jsx(re,{className:"h-5 w-5 text-yellow-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-700",children:"Batas Waktu Pembayaran"}),e.jsx("p",{className:"text-yellow-600",children:q||"Menghitung..."}),e.jsx("p",{className:"text-sm text-yellow-600",children:"Pembayaran akan dibatalkan secara otomatis jika melewati batas waktu"})]})]}),e.jsxs("div",{className:`mb-8 ${S!==1&&"opacity-100"}`,children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-pink-600 text-white rounded-full flex items-center justify-center font-bold mr-3",children:"1"}),e.jsx("h2",{className:"text-lg font-medium",children:"Pilih Metode Pembayaran"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${i==="bank_transfer"?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-pink-200 hover:bg-pink-50/30"}`,onClick:()=>_("bank_transfer"),children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${i==="bank_transfer"?"bg-pink-100 text-pink-600":"bg-gray-100 text-gray-600"}`,children:e.jsx($,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:"Transfer Bank"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload bukti pembayaran untuk diverifikasi admin"})]}),e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${i==="virtual_account"?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-pink-200 hover:bg-pink-50/30"}`,onClick:()=>_("virtual_account"),children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${i==="virtual_account"?"bg-pink-100 text-pink-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(A,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:"Virtual Account"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pembayaran dengan Virtual Account melalui Midtrans"})]}),e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${i==="cash"?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-pink-200 hover:bg-pink-50/30"}`,onClick:()=>_("cash"),children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:`p-2 rounded-full mr-3 ${i==="cash"?"bg-pink-100 text-pink-600":"bg-gray-100 text-gray-600"}`,children:e.jsx(ie,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:"Tunai"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Pembayaran tunai langsung kepada admin"})]})]}),d.payment_method&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:d.payment_method})]}),S>=2&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-pink-600 text-white rounded-full flex items-center justify-center font-bold mr-3",children:"2"}),e.jsx("h2",{className:"text-lg font-medium",children:"Detail Pembayaran"})]}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tipe Pembayaran"}),e.jsxs("select",{value:t.payment_type,onChange:a=>m("payment_type",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500",children:[s.requires_down_payment&&e.jsx("option",{value:"down_payment",children:"Uang Muka"}),e.jsx("option",{value:"installment",children:"Cicilan"}),e.jsx("option",{value:"full_payment",children:"Pelunasan"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Jumlah Pembayaran"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500",children:"Rp"}),e.jsx("input",{type:"text",value:J,onChange:Q,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500",placeholder:"0",required:!0})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Maksimal: ",p(s.remainingAmount)]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("button",{type:"button",onClick:()=>C(1),className:"text-pink-600 hover:text-pink-800 font-medium flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Ubah Metode Pembayaran"]})}),i==="bank_transfer"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-md font-medium mb-3",children:"Pilih Bank"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:E.map(a=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer flex items-center ${l&&l.id===a.id?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-pink-200"}`,onClick:()=>K(a),children:[a.logo?e.jsx("img",{src:a.logo,alt:a.name,className:"h-8 mr-3"}):e.jsx("div",{className:"p-1 bg-gray-100 rounded-md mr-3",children:e.jsx($,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:a.account_number})]})]},a.id))}),d.bank_code&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:d.bank_code}),l&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-md font-medium mb-3",children:"Upload Bukti Pembayaran"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",id:"payment_proof",className:"hidden",accept:"image/*",onChange:W}),D?e.jsxs("div",{children:[e.jsx("img",{src:D,alt:"Preview",className:"max-h-64 mx-auto mb-3"}),e.jsx("button",{type:"button",onClick:()=>{N(null),m("payment_proof",null)},className:"text-red-500 text-sm hover:text-red-700",children:"Hapus Gambar"})]}):e.jsxs("label",{htmlFor:"payment_proof",className:"cursor-pointer block",children:[e.jsx(le,{className:"h-10 w-10 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-700 font-medium",children:"Klik untuk mengunggah bukti pembayaran"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Format: JPG, JPEG, PNG (Maks. 5MB)"})]}),d.payment_proof&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:d.payment_proof})]})]})]}),i==="virtual_account"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-md font-medium mb-3",children:"Pilih Bank untuk Virtual Account"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:j&&j.length>0?j.map(a=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer flex items-center ${t.bank_code===a.bank_code?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-pink-200"}`,onClick:()=>O(a),children:[a.logo?e.jsx("img",{src:a.logo,alt:a.name,className:"h-8 w-8 object-contain mr-3"}):e.jsx("div",{className:"p-1 bg-gray-100 rounded-md mr-3",children:e.jsx(A,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:a.description||"Virtual Account"})]})]},a.id)):[{bank_code:"BCA",name:"BCA Virtual Account"},{bank_code:"BNI",name:"BNI Virtual Account"},{bank_code:"BRI",name:"BRI Virtual Account"},{bank_code:"MANDIRI",name:"Mandiri Virtual Account"},{bank_code:"CIMB",name:"CIMB Niaga Virtual Account"}].map(a=>e.jsxs("div",{className:`p-3 border rounded-lg cursor-pointer flex items-center ${t.bank_code===a.bank_code?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-pink-200"}`,onClick:()=>m("bank_code",a.bank_code),children:[e.jsx("div",{className:"p-1 bg-gray-100 rounded-md mr-3",children:e.jsx(A,{className:"h-6 w-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Virtual Account"})]})]},a.bank_code))}),d.bank_code&&e.jsx("div",{className:"text-red-500 text-sm mt-2",children:d.bank_code}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(me,{className:"h-5 w-5 text-blue-500 mr-3 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-700",children:"Informasi Virtual Account"}),e.jsx("p",{className:"text-sm text-blue-600 mt-1",children:"Setelah melanjutkan, Anda akan mendapatkan nomor Virtual Account yang harus dibayarkan. Pembayaran akan diverifikasi secara otomatis. Virtual Account akan aktif selama 24 jam."})]})]})})]}),i==="cash"&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(de,{className:"h-5 w-5 text-green-500 mr-3 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-700",children:"Informasi Pembayaran Tunai"}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["Pembayaran tunai akan langsung diverifikasi oleh admin. Pastikan Anda telah menyerahkan uang tunai sebesar"," ",e.jsx("span",{className:"font-medium",children:p(t.amount)})," ","kepada admin yang berwenang."]})]})]})}),e.jsx("div",{className:"flex justify-end mt-8",children:e.jsx("button",{type:"button",onClick:()=>y(!0),className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors",disabled:i==="bank_transfer"&&(!l||!t.payment_proof)||i==="virtual_account"&&!t.bank_code||G||t.amount<=0,children:"Lanjutkan Pembayaran"})})]})]})]}),e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"Petunjuk Pembayaran"}),i==="bank_transfer"&&e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Cara Pembayaran Transfer Bank:"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-gray-700",children:[e.jsx("li",{children:"Transfer dana sesuai jumlah tagihan ke rekening yang dipilih"}),e.jsx("li",{children:"Simpan bukti transfer (screenshot atau foto)"}),e.jsx("li",{children:"Unggah bukti transfer pada form di atas"}),e.jsx("li",{children:"Admin akan memverifikasi pembayaran Anda dalam 1x24 jam"})]})]}),l&&e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Informasi Rekening:"}),e.jsxs("p",{children:["Bank: ",l.name]}),e.jsxs("p",{children:["No. Rekening: ",l.account_number]}),e.jsxs("p",{children:["Atas Nama: ",l.account_name]}),e.jsxs("p",{className:"text-pink-600 font-medium mt-2",children:["Total: ",p(t.amount)]})]})]}),i==="virtual_account"&&e.jsx("div",{children:x&&x.payment_instructions&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsxs("h4",{className:"font-medium text-blue-700 mb-2",children:["Instruksi Detail untuk ",x.name,":"]}),e.jsx("ol",{className:"list-decimal ml-5 space-y-1 text-blue-700",children:x.payment_instructions.map((a,r)=>e.jsx("li",{className:"text-sm",children:a.instruction},r))})]})}),i==="cash"&&e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Cara Pembayaran Tunai:"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-gray-700",children:[e.jsxs("li",{children:["Serahkan uang tunai sebesar ",p(t.amount)," kepada admin"]}),e.jsx("li",{children:"Dapatkan bukti pembayaran dari admin"}),e.jsx("li",{children:"Pembayaran akan langsung terverifikasi oleh sistem"})]})]})]})]}),L&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-lg w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Konfirmasi Pembayaran"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Anda akan memproses pembayaran dengan detail berikut:"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Jumlah"}),e.jsx("p",{className:"font-semibold",children:p(t.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Metode"}),e.jsx("p",{className:"font-semibold",children:t.payment_method==="bank_transfer"?"Transfer Bank":t.payment_method==="virtual_account"?"Virtual Account":"Tunai"})]}),t.payment_method==="bank_transfer"&&l&&e.jsxs("div",{className:"col-span-2 mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Bank Tujuan"}),e.jsxs("p",{className:"font-semibold",children:[l.name," - ",l.account_number]})]}),t.payment_method==="virtual_account"&&t.bank_code&&e.jsxs("div",{className:"col-span-2 mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Virtual Account"}),e.jsx("p",{className:"font-semibold",children:x?x.name:`Bank ${t.bank_code}`})]})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>y(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"button",onClick:z,disabled:M,className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors disabled:bg-pink-300",children:M?e.jsxs("span",{className:"flex items-center",children:[e.jsx(oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Memproses..."]}):"Konfirmasi Pembayaran"})]})]})})]})};export{De as default};
