import{r as m,S as A,j as a}from"./app-Bj-2ttWe.js";import G from"./PortfolioFormFields-B_vR3CA5.js";import R from"./PortfolioImageUploader-D33gJWi3.js";import{X as B}from"./x-P4FUM78l.js";import{S as M}from"./save-Dex4yvPJ.js";import"./plus-C9N-fGdW.js";import"./createLucideIcon-Q6M-lg5u.js";import"./trash-BLUPGPli.js";import"./chevron-left-Dic_PlZf.js";import"./chevron-right-CIgsXY0k.js";const P=({isOpen:O,setIsOpen:T,editingPortfolio:t,categories:y})=>{const k=m.useRef(null),[j,D]=m.useState(!1),[f,v]=m.useState([]),[c,_]=m.useState([]),[g,I]=m.useState(0),{data:i,setData:p,post:w,processing:S,errors:N,clearErrors:F,setError:o}=A({title:t?t.title:"",category:t?t.category:y[0],description:t?t.description:"",images:[],delete_image_ids:[],_method:t?"PUT":""}),E=r=>{const{name:e,value:s,type:d,files:n}=r.target;if(d==="file"){if(n&&n.length>0){const u=Array.from(n),x=[];let h=!1;for(let l=0;l<u.length;l++){const b=u[l];if(!["image/jpeg","image/png","image/gif","image/jpg"].includes(b.type)){o("images","Please select valid image files (JPEG, PNG, GIF)"),h=!0;break}if(b.size>2*1024*1024){o("images","Image size should be less than 2MB"),h=!0;break}x.push(b)}if(h)return;F("images"),v(l=>[...l,...x]),p(l=>({...l,images:[...l.images,...x]}))}}else p(e,s)},U=r=>{const e=[...f];e.splice(r,1),v(e);const s=[...i.images];s.splice(r,1),p({...i,images:s})},z=r=>{const e=[...c],s=e.indexOf(r);s===-1?e.push(r):e.splice(s,1),_(e),p("delete_image_ids",e)},C=r=>{if(!t||!t.images)return;const e=t.images.length;if(e<=1)return;let s;r==="next"?s=(g+1)%e:s=(g-1+e)%e,I(s)},q=r=>{r.preventDefault();let e=!1;if(i.title.trim()||(o("title","Title is required"),e=!0),i.description.trim()||(o("description","Description is required"),e=!0),!t&&i.images.length===0&&(o("images","At least one image is required for new portfolios"),e=!0),e)return;const s=new FormData;s.append("title",i.title),s.append("category",i.category),s.append("description",i.description),i.images.forEach((n,u)=>{s.append(`images[${u}]`,n)}),t&&c.length>0&&c.forEach(n=>{s.append("delete_image_ids[]",n)}),t&&s.append("_method","PUT"),D(!0);const d={preserveState:!1,preserveScroll:!0,forceFormData:!0};w(t?route("admin.portfolios.update",t.id):route("admin.portfolios.store"),s,d)};return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl flex flex-col max-h-[90vh]",children:[a.jsx("div",{className:"p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl z-10",children:a.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:t?"Edit Portfolio":"Tambah Portfolio Baru"})}),a.jsx("div",{className:"p-6 overflow-y-auto flex-1",children:a.jsxs("form",{id:"portfolioForm",onSubmit:q,encType:"multipart/form-data",className:"space-y-6",children:[a.jsx(G,{data:i,errors:N,categories:y,handleInputChange:E}),a.jsx(R,{fileInputRef:k,selectedImages:f,imagesToDelete:c,currentImageIndex:g,setCurrentImageIndex:I,editingPortfolio:t,errors:N,handleInputChange:E,removeSelectedImage:U,toggleImageDeletion:z,navigateImage:C})]})}),a.jsx("div",{className:"p-6 border-t border-gray-200 sticky bottom-0 bg-white rounded-b-xl z-10",children:a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsxs("button",{type:"button",onClick:()=>T(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md inline-flex items-center",children:[a.jsx(B,{className:"w-4 h-4 mr-2"}),"Cancel"]}),a.jsxs("button",{type:"submit",form:"portfolioForm",disabled:S||j||!t&&f.length===0,className:"px-6 py-2 bg-pink-600 text-white rounded-md hover:bg-pink-700 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 disabled:opacity-70 disabled:cursor-not-allowed inline-flex items-center",children:[a.jsx(M,{className:"w-4 h-4 mr-2"}),j?"Uploading...":S?"Processing...":t?"Update":"Save"]})]})})]})})};export{P as default};
