import{r as m,j as e}from"./app-Bs2T8Cel.js";import{X as $}from"./x-C6So-ddW.js";import{C as z}from"./circle-check-big-CyiEMgwB.js";import{E as M}from"./eye-off-DnHwywYB.js";import{E as O}from"./eye-CjirJiX5.js";import{S as H}from"./save-CKqFpiyj.js";import"./createLucideIcon-CvzI4D8G.js";const K=({user:n,onClose:v,onSave:k})=>{const[p,P]=m.useState(""),[x,C]=m.useState(""),[u,E]=m.useState(""),[d,B]=m.useState(""),[j,S]=m.useState("user"),[y,R]=m.useState(!1),[a,i]=m.useState({}),[l,b]=m.useState({name:!1,phone:!1,email:!1,password:!1}),[h,g]=m.useState(!1),[F,f]=m.useState("");m.useEffect(()=>{n&&(P(n.name||""),C(n.phone||""),E(n.email||""),S(n.role||"user"),b({name:!1,phone:!1,email:!1,password:!1}),i({}))},[n]);const A=t=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t),U=t=>/^([0-9\s\-\+\(\)]*)$/.test(t)&&t.length>=10,q=t=>{const r=t.target.value;C(r),b({...l,phone:!0}),c("phone",r)},c=(t,r)=>{const s={...a};if(n){if(t==="email"&&r===n.email)return delete s.email,i(s),!0;if(t==="phone"&&r===n.phone)return delete s.phone,i(s),!0}switch(t){case"name":r.trim()?delete s.name:s.name="Name is required";break;case"email":r.trim()?A(r)?delete s.email:s.email="Please enter a valid email address":s.email="Email is required";break;case"phone":r.trim()?U(r)?delete s.phone:s.phone="Please enter a valid phone number (min 10 digits)":s.phone="Phone number is required";break;case"password":!n&&!r.trim()?s.password="Password is required for new users":r&&r.length<8?s.password="Password must be at least 8 characters":delete s.password;break}return i(s),Object.keys(s).length===0},w=t=>{switch(b({...l,[t]:!0}),t){case"name":c("name",p);break;case"email":c("email",u);break;case"phone":c("phone",x);break;case"password":c("password",d);break}},N=(t,r)=>{const{value:s}=t.target;switch(r){case"name":P(s);break;case"email":E(s);break;case"password":B(s);break}b({...l,[r]:!0}),c(r,s)},D=()=>{n&&u===n.email&&delete a.email,n&&x===n.phone&&delete a.phone;const t=c("name",p),r=!a.email,s=!a.phone,o=c("password",d);return b({name:!0,email:!0,phone:!0,password:!0}),t&&r&&s&&o},Z=t=>{if(t.preventDefault(),f(""),g(!0),n){const r={name:p,phone:x,email:u,role:j};d&&(r.password=d),k(r,{onError:s=>{console.error("Update errors:",s),g(!1),typeof s=="object"?(s.email&&i(o=>({...o,email:s.email})),s.phone&&i(o=>({...o,phone:s.phone})),s.name&&i(o=>({...o,name:s.name})),s.password&&i(o=>({...o,password:s.password})),s.error&&f(s.error)):f("Failed to update user. Please try again.")}});return}if(D()){const r={name:p,phone:x,email:u,role:j};d&&(r.password=d),k(r,{onError:s=>{console.error("Create errors:",s),g(!1),typeof s=="object"?(s.email&&i(o=>({...o,email:s.email})),s.phone&&i(o=>({...o,phone:s.phone})),s.name&&i(o=>({...o,name:s.name})),s.password&&i(o=>({...o,password:s.password})),s.error&&f(s.error)):f("Failed to create user. Please try again.")}})}else g(!1)},I=()=>{R(!y)},V=()=>n?p.trim()!=="":!l.name||!l.email||!l.phone||!l.password?!1:!a.name&&!a.email&&!a.phone&&!a.password;return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:n?"Edit User":"Add New User"}),e.jsx("button",{onClick:v,className:"text-gray-500 hover:text-gray-700",disabled:h,children:e.jsx($,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:Z,className:"p-6",children:[F&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-600 text-sm rounded-md",children:F}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:["Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:p,onChange:t=>N(t,"name"),onBlur:()=>w("name"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.name&&a.name?"border-red-500":l.name&&!a.name?"border-green-500":"border-gray-300"}`}),l.name&&a.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"tel",value:x,onChange:q,onBlur:()=>w("phone"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.phone&&a.phone?"border-red-500":l.phone&&!a.phone?"border-green-500":"border-gray-300"}`,placeholder:"123-456-7890"}),l.phone&&!a.phone&&e.jsx(z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-green-500"})]}),l.phone&&a.phone?e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.phone}):e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Format: 123-456-7890"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:["Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:u,onChange:t=>N(t,"email"),onBlur:()=>w("email"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.email&&a.email?"border-red-500":l.email&&!a.email?"border-green-500":"border-gray-300"}`,placeholder:"user@example.com"}),l.email&&!a.email&&e.jsx(z,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-green-500"})]}),l.email&&a.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.email})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{value:j,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block mb-2 text-sm font-medium text-gray-700",children:[n?"Password (leave blank to keep current)":"Password",!n&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:y?"text":"password",value:d,onChange:t=>N(t,"password"),onBlur:()=>w("password"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.password&&a.password?"border-red-500":l.password&&d&&!a.password?"border-green-500":"border-gray-300"}`}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500 hover:text-gray-700",onClick:I,children:y?e.jsx(M,{size:18}):e.jsx(O,{size:18})})]}),l.password&&a.password?e.jsx("p",{className:"text-red-500 text-xs mt-1",children:a.password}):e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:n?"Leave blank to keep current password":"Password must be at least 8 characters"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsxs("button",{type:"button",onClick:v,disabled:h,className:`px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition ${h?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx($,{className:"w-4 h-4 mr-2 inline-block"}),"Cancel"]}),e.jsx("button",{type:"submit",disabled:!V()&&!n||h,className:`px-4 py-2 rounded-md transition flex items-center ${V()||n?"bg-blue-500 text-white hover:bg-blue-600":"bg-blue-300 text-white cursor-not-allowed"} ${h?"opacity-70 cursor-not-allowed":""}`,children:h?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),n?"Update":"Create"]})})]})]})]})})};export{K as default};
