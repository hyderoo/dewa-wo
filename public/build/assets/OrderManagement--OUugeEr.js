import{q as I,r as t,j as e,a as X,f as m}from"./app-Bj-2ttWe.js";import{A as J}from"./AdminLayout-C9KiesPq.js";import Q from"./OrderManagementHeader-DbPnPz4m.js";import Y from"./OrderList-BBROfEBU.js";import{T as Z}from"./Toast-0AKSzmFv.js";import{X as f}from"./x-P4FUM78l.js";import{C as A}from"./circle-alert-DbwOTSu0.js";import{C as ee}from"./circle-x-BZ6o9ve8.js";import{D as se}from"./file-text-BGbz3DAs.js";import{C as ae}from"./calendar-B2PhcqWp.js";import{C as te}from"./circle-check-big-3DSExcF6.js";import{S as O}from"./star-IVzQzElw.js";import"./createLucideIcon-Q6M-lg5u.js";import"./eye-off-eoUXuo7G.js";import"./eye-BR07TQjy.js";import"./log-out-DiVVTNjJ.js";import"./chevron-down-BOcF8omZ.js";import"./chevron-right-CIgsXY0k.js";import"./key-round-BKENG61x.js";import"./users-Dpajf5mq.js";import"./image-B3SenHd_.js";import"./building-C3Qd_UEZ.js";import"./credit-card-UvNpbFda.js";import"./circle-plus-BTzkBTnu.js";import"./search-CxmgQfz-.js";import"./funnel-D9_HO87W.js";import"./map-pin-C7XS4VMC.js";import"./chevron-up-DKEh130A.js";import"./square-pen-DfUrHUBV.js";import"./chevron-left-Dic_PlZf.js";const ze=()=>{const{orders:d,pagination:R,filters:B,toast:x}=I().props,[F,r]=t.useState(!!x),[y,i]=t.useState(x||{type:"",message:""}),[g,z]=t.useState(B||{status:"all",date:"all",search:"",page:1}),[T,E]=t.useState(0),[D,L]=t.useState(0),[a,u]=t.useState(null),[_,N]=t.useState(!1),[H,w]=t.useState(!1),[V,v]=t.useState(!1),[p,k]=t.useState(""),[C,S]=t.useState(5),[j,M]=t.useState(""),[c,l]=t.useState(!1);t.useEffect(()=>{if(d){const s=d.filter(o=>o.status==="pending_payment").length,b=d.filter(o=>o.status==="completed").length;E(s),L(b)}},[d]),t.useEffect(()=>{if(x){r(!0);const s=setTimeout(()=>{r(!1)},5e3);return()=>clearTimeout(s)}},[x]);const P=s=>{z({...g,...s,page:s.page||1}),m.get(route("admin.orders"),{...g,...s,page:s.page||1},{preserveState:!0,replace:!0})},$=s=>{P({page:s})},q=()=>{m.visit(route("admin.orders.create"))},n=()=>{u(null),N(!1),w(!1),v(!1),k(""),S(5),M("")},G=()=>{if(!p.trim()){i({type:"error",message:"Alasan pembatalan harus diisi"}),r(!0);return}l(!0),m.patch(route("admin.orders.update-status",a.id),{status:"cancelled",cancel_reason:p},{onSuccess:()=>{i({type:"success",message:"Pesanan berhasil dibatalkan"}),r(!0),n(),l(!1)},onError:()=>{i({type:"error",message:"Gagal membatalkan pesanan. Silakan coba lagi."}),r(!0),l(!1)}})},K=()=>{l(!0),m.patch(route("admin.orders.update-status",a.id),{status:"completed"},{onSuccess:()=>{i({type:"success",message:"Pesanan berhasil diselesaikan"}),r(!0),n(),l(!1)},onError:()=>{i({type:"error",message:"Gagal menyelesaikan pesanan. Silakan coba lagi."}),r(!0),l(!1)}})},U=()=>{if(!j.trim()){i({type:"error",message:"Komentar ulasan harus diisi"}),r(!0);return}l(!0),m.post(route("admin.orders.review",a.id),{rating:C,comment:j},{onSuccess:()=>{i({type:"success",message:"Ulasan berhasil dikirim"}),r(!0),n(),l(!1)},onError:()=>{i({type:"error",message:"Gagal mengirim ulasan. Silakan coba lagi."}),r(!0),l(!1)}})},W=({rating:s,onRatingChange:b,readonly:o=!1})=>e.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(h=>e.jsx("button",{type:"button",onClick:()=>!o&&b(h),disabled:o,className:`${h<=s?"text-yellow-400":"text-gray-300"} focus:outline-none ${!o&&"hover:text-yellow-400"}`,children:e.jsx(O,{className:`w-6 h-6 ${h<=s?"fill-yellow-400":""}`})},h))});return e.jsxs(J,{activeMenu:"order-management",children:[e.jsx(X,{title:"Order Management"}),F&&e.jsx(Z,{type:y.type,message:y.message,onClose:()=>r(!1)}),e.jsxs("div",{className:"py-6 px-4 sm:px-6 lg:px-8",children:[e.jsx(Q,{pendingCount:T,completedCount:D,onCreateOrder:q}),e.jsx(Y,{orders:d,pagination:R,onPageChange:$,filters:g,onFilterChange:P,onCancelOrder:s=>{u(s),N(!0)},onCompleteOrder:s=>{u(s),w(!0)},onAddReview:s=>{u(s),v(!0)},onViewDetails:s=>{m.visit(route("admin.orders.show",s))}})]}),_&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Batalkan Pesanan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Pesanan: ",a.order_number," - ",a.clientName]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-500",children:e.jsx(f,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-100 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(A,{className:"h-5 w-5 text-yellow-600 mr-2 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Pesanan yang dibatalkan tidak dapat dikembalikan. Mohon pastikan kembali tindakan ini."})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Alasan Pembatalan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:p,onChange:s=>k(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500",rows:"3",placeholder:"Masukkan alasan pembatalan...",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Batal"}),e.jsx("button",{onClick:G,disabled:c,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Batalkan Pesanan"]})})]})]})}),H&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Selesaikan Pesanan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Pesanan: ",a.order_number," - ",a.clientName]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-500",children:e.jsx(f,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100 mb-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(A,{className:"h-5 w-5 text-blue-600 mr-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Anda akan menandai pesanan ini sebagai selesai."}),e.jsx("p",{className:"text-sm text-blue-700",children:a.isFullyPaid?"Pesanan ini sudah lunas dibayar.":"Perhatian: Pesanan ini belum lunas, pastikan pembayaran sudah diselesaikan sebelum menyelesaikan pesanan."})]})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(se,{className:"h-5 w-5 text-green-500 mr-2"}),e.jsxs("div",{className:"text-gray-700",children:[e.jsx("p",{className:"font-medium",children:"Status Pembayaran"}),e.jsx("p",{className:`text-sm ${a.isFullyPaid?"text-green-600":"text-yellow-600"}`,children:a.isFullyPaid?"Lunas":"Belum Lunas"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"h-5 w-5 text-blue-500 mr-2"}),e.jsxs("div",{className:"text-gray-700",children:[e.jsx("p",{className:"font-medium",children:"Tanggal Acara"}),e.jsx("p",{className:"text-sm",children:new Date(a.date).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Batal"}),e.jsx("button",{onClick:K,disabled:c,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),"Selesaikan Pesanan"]})})]})]})}),V&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Tambah Ulasan"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Pesanan: ",a.order_number," - ",a.clientName]})]}),e.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-500",children:e.jsx(f,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Rating ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(W,{rating:C,onRatingChange:S})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Komentar ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:j,onChange:s=>M(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500",rows:"4",placeholder:"Berikan komentar atas pengalaman klien...",required:!0})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Batal"}),e.jsx("button",{onClick:U,disabled:c,className:"px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors flex items-center",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Memproses..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"Kirim Ulasan"]})})]})]})})]})};export{ze as default};
